general:
  name: httpsql
components:
  - type: template
    template: postgres
    name: db
    vars:
      CONFIG: postgres-conf
  - type: template
    template: cassandra
    name: cass
    vars: {}
  - type: stateless
    name: api
    containers:
      - dir: ./
        resources:
          cpu:
            min: 0.1
          memory:
            min: 128
        readyCheck:
          httpGet:
            port: 80
            path: /check/ready
        aliveCheck:
          httpGet:
            port: 80
            path: /check/alive
        envVars:
          DB_PROVIDER: cassandra
          DB_HOST: cass
    expose:
      - servicePort: 80
        containerPort: 80
        external: true
      - servicePort: 8000
        containerPort: 8000
        external: false
        metricsPath: /metrics
    instances: 3
tests:
  - name: func
    containers:
      - dir: ./tests/func
  - name: perf
    containers:
      - dir: ./tests/perf
    instances: 3
volumes:
  - name: postgres-conf
    path: config/postgres.conf
